pipeline {
    agent any

    parameters {
        string defaultValue: '5711', name: 'REF_ID', trim: true, description: 'This value parameterizes the docker project name and network!'
    }

    stages {
        stage('Clean up') {
            parallel {
                stage('Remove stack') {
                    steps {
                        script { env.REF_ID = params.REF_ID }
                        sh "docker stack rm jobshop_test_stack_${REF_ID}"
                        sleep 15
                        sh "docker volume rm jobshop_test_stack_${REF_ID}_mysql_data"
                    }
                }
                stage('Remove temp folders') {
                    steps {
                        sh '''
                            rm -rf /usr/tmp/keycloak-assets
                            rm -rf /usr/tmp/init
                        '''
                    }
                }
            }
        }
    }

    post {
        always {
            cleanWs()
        }
    }
}
